<!DOCTYPE html>
<html>

<head>
    <title>http://localhost:5002/api/customer</title>
</head>

<body>
    <div id="form-container">
        <!-- The form and messages will be injected here -->
    </div>
    <script>
        const container = document.getElementById('form-container');
        const form = document.createElement('form');
        form.style.cssText = 'max-width: 400px; margin: 0 auto; padding: 20px; border: 1px solid #ccc; border-radius: 5px; box-shadow: 0 0 10px rgba(0, 0, 0, 0.1); display: flex; flex-direction: column;';

        const createInput = (type, name, placeholder) => {
            const input = document.createElement('input');
            input.type = type;
            input.name = name;
            input.placeholder = placeholder;
            input.style.cssText = 'padding: 10px; margin-bottom: 10px; border: 1px solid #ccc; border-radius: 5px; transition: border-color 0.3s ease-in-out;' + (type === 'number' ? 'text-align: center; font-size: 20px;' : '');
            if (type === 'number') {
                input.setAttribute('inputmode', 'numeric');
                input.style.appearance = 'textfield';
                input.addEventListener('input', function () {
                    if (this.value.length > 1) {
                        this.value = this.value.slice(0, 1);
                    }
                });
            }
            return input;
        };

        const firstNameInput = createInput('text', 'firstName', 'First Name');
        const lastNameInput = createInput('text', 'lastName', 'Last Name');
        const emailInput = createInput('email', 'email', 'Email');

        const otpContainer = document.createElement('div');
        otpContainer.style.display = 'none';
        otpContainer.style.justifyContent = 'center';
        const otpInputs = [];

        for (let i = 0; i < 6; i++) {
            const otpInput = createInput('number', 'otp' + i, '');
            otpInput.style.width = '40px';
            otpInput.style.marginRight = '5px';
            otpInput.style.appearance = 'textfield';
            otpInputs.push(otpInput);
            otpContainer.appendChild(otpInput);
        }

        const submitButton = document.createElement('button');
        submitButton.type = 'submit';
        submitButton.textContent = 'Submit';
        submitButton.style.cssText = 'background-color: #007bff; color: #fff; cursor: pointer; padding: 10px; transition: background-color 0.3s ease-in-out;';

        const messageElement = document.createElement('p');
        messageElement.style.cssText = 'margin-top: 10px; font-weight: bold; text-align: center; transition: opacity 0.3s ease-in-out; color: red;';

        form.appendChild(firstNameInput);
        form.appendChild(lastNameInput);
        form.appendChild(emailInput);
        form.appendChild(otpContainer);
        form.appendChild(submitButton);
        form.appendChild(messageElement);

        container.appendChild(form);

        form.addEventListener('submit', function (event) {
            event.preventDefault();
            form.classList.add('loading');
            const formData = new FormData(form);
            const jsonData = {};
            formData.forEach((value, key) => {
                jsonData[key] = value;
            });
            fetch('https://your-api-endpoint.com/submit', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(jsonData),
            })
            .then(response => response.json())
            .then(data => {
                form.classList.remove('loading');
                if (data.isPersonalEmail) {
                    messageElement.textContent = 'Sorry, you are not eligible for offers.';
                } else {
                    firstNameInput.disabled = true;
                    lastNameInput.disabled = true;
                    emailInput.disabled = true;
                    otpContainer.style.display = 'flex';
                    submitButton.textContent = 'Verify OTP';
                    form.addEventListener('submit', function (otpEvent) {
                        otpEvent.preventDefault();
                        const otpValues = otpInputs.map(input => input.value).join('');
                        fetch('https://your-otp-verification-endpoint.com/verify', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                            },
                            body: JSON.stringify({ otp: otpValues }),
                        })
                        .then(otpResponse => otpResponse.json())
                        .then(otpData => {
                            if (otpData.isVerified) {
                                messageElement.textContent = 'Success! You are registered and eligible for offers.';
                            } else {
                                messageElement.textContent = 'OTP verification failed. Please re-enter OTP.';
                            }
                        })
                        .catch(otpError => {
                            messageElement.textContent = 'An error occurred while verifying OTP.';
                            console.error('OTP Verification Error:', otpError);
                        });
                    });
                }
            })
            .catch(error => {
                form.classList.remove('loading');
                messageElement.textContent = 'An error occurred while processing your request.';
                console.error('Error:', error);
            });
        });
    </script></body>

</html>